---
title: "[Pandas] merge 과정에서 컬럼의 Data Type이 의도하치 않게 float64로 바뀌는 문제" # 제목 (필수)
excerpt: "컬럼에 NaN 값이 존재하지는 않는지 살펴보자"  # 서브 타이틀이자 meta description (필수)
date: 2025-12-11 12:30:00 +0900      # 작성일 (필수)
lastmod: 2025-12-11 12:30:00 +0900   # 최종 수정일 (필수)
last_modified_at: 2025-12-11 12:30:00 +0900   # 최종 수정일 (필수)
categories: Python        # 다수 카테고리에 포함 가능 (필수)
tags: python 파이썬 pandas 판다스 merge float64 float 바뀜                     # 태그 복수개 가능 (필수)
classes: wide        # wide : 넓은 레이아웃 / 빈칸 : 기본 //// wide 시에는 sticky toc 불가
toc: true        # 목차 표시 여부
toc_label:       # toc 제목
toc_sticky: true # 이동하는 목차 표시 여부 (toc:true 필요) // wide 시에는 sticky toc 불가
header: 
  image:         # 헤더 이미지 (asset내 혹은 url)
  teaser:        # 티저 이미지??
  overlay_image: /assets/images/banners/banner.gif            # 헤더 이미지 (제목과 겹치게)
  # overlay_color: '#333'            # 헤더 배경색 (제목과 겹치게) #333 : 짙은 회색 (필수)
  video:
    id:                      # 영상 ID (URL 뒷부분)
    provider:                # youtube, vimeo 등
sitemap :                    # 구글 크롤링
  changefreq : daily         # 구글 크롤링
  priority : 1.0             # 구글 크롤링
author: # 주인 외 작성자 표기 필요시
permalink: 
sidebar:
  nav: docs_pandas
---
<!--postNo: 20251211_001-->

## 현상  

- 상황 : pandas의 두 데이터프레임을 merge 했을 때  
- 현상 : 특정 컬럼의 값이 `float64`로 자동으로 변경됨  

```python
import pandas as pd

user_data = {
    "user_id" : ["0001", "0002", "0003", "0004", "0005"],
    "name" : ["john", "mike", "merry", "poppins", "jenny"],
    "age" : [20, 30, 40, 50, 60]
}

purchase_history = {
    "user_id" : ["0001", "0002", "0001", "0004", "0005", "0006"],
    "item_id" : ["IT01", "IT33", "IT13", "IT99", "IT62", "IT43"],
    "price" : [3000, 52000, 950, 4350, 800, 5550]
    }

user_df = pd.DataFrame(user_data)
purchase_history_df = pd.DataFrame(purchase_history)
merge_pu = purchase_history_df.merge(user_df, on="user_id", how="left")

print("===== user_df =====")
print(user_df.info())
print("===== merge =====")
print(merge_pu.info())
```

```bash
# 출력
===== user_df =====
Data columns (total 3 columns):
 i   Column   Non-Null Count  Dtype 
---  ------   --------------  ----- 
 0   user_id  5 non-null      object
 1   name     5 non-null      object
 2   age      5 non-null      int64      # <<<< 원래 int64형 
dtypes: int64(1), object(2)

===== merge =====
Data columns (total 5 columns):
 i   Column   Non-Null Count  Dtype  
---  ------   --------------  -----  
 0   user_id  6 non-null      object 
 1   item_id  6 non-null      object 
 2   price    6 non-null      int64  
 3   name     5 non-null      object 
 4   age      5 non-null      float64    # <<<< float으로 바뀜
dtypes: float64(1), int64(1), object(3)
```


## 원인  

- merge 과정에서 해당 컬럼에 `NaN`이 포함되기 때문에 **pandas가 해당 컬럼의 dtype을 `float64`로 자동 승격**시키기 때문  


## 해결  

### 해결 방법 리스트  

|No|해결 방법|
|---|---|
|1|의도한 대로 merge를 설정한건지 검토(merge key 등)|
|2|NaN 값을 처리한 뒤, 해당 컬럼을 다시 int로|
|3|NaN이 예상되는 컬럼을 Int64 타입으로 관리|

### merge 설정 검토  

- merge 할 때 의도에 맞게 코딩을 했는지 검토한다.  
- merge key (on)은 잘 설정했는지, merge하는 df들은 정상인지 등  

### NaN값 처리 후 int로 변환  

- NaN값을 적절한 값으로 처리한다 : 제거, 대치, 보간  
- 이후 해당 컬럼을 다시 int 형으로 변환한다.  

```python
merge_pu = purchase_history_df.merge(user_df, on="user_id", how="left")
merge_pu["age"] = merge_pu["age"].fillna(99) # 대치
merge_pu["age"].astype("int64")              # 변환
print(merge_pu.info())
```

```bash
# 출력
Data columns (total 5 columns):
 i   Column   Non-Null Count  Dtype 
---  ------   --------------  ----- 
 0   user_id  6 non-null      object
 1   item_id  6 non-null      object
 2   price    6 non-null      int64 
 3   name     5 non-null      object
 4   age      6 non-null      int64 
dtypes: int64(2), object(3)
```


### `Int64` 데이터타입 사용  

- `Int64` 데이터타입은, NaN값을 허용하는 데이터타입이다.  

```python
user_df["age"] = user_df["age"].astype("Int64")
merge_pu = purchase_history_df.merge(user_df, on="user_id", how="left")
print(merge_pu.info())
```

```bash
# 출력
Data columns (total 5 columns):
 i   Column   Non-Null Count  Dtype 
---  ------   --------------  ----- 
 0   user_id  6 non-null      object
 1   item_id  6 non-null      object
 2   price    6 non-null      int64 
 3   name     5 non-null      object
 4   age      5 non-null      Int64 
dtypes: Int64(1), int64(1), object(3)
```